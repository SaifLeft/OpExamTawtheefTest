@model TawtheefTest.ViewModels.OpExamQuestionSetViewModel

@{
  ViewData["Title"] = "إنشاء مجموعة أسئلة جديدة";
}

<div class="container-xxl flex-grow-1 container-p-y">
  <h4 class="fw-bold py-3 mb-4">
    <span class="text-muted fw-light">إدارة الأسئلة /</span> إنشاء مجموعة أسئلة جديدة
  </h4>

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">بيانات مجموعة الأسئلة</h5>
        </div>
        <div class="card-body">
          <form asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger mb-3"></div>

            <input type="hidden" asp-for="ExamId" />

            <div class="mb-3">
              <label asp-for="Name" class="form-label"></label>
              <input asp-for="Name" class="form-control" />
              <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="mb-3">
              <label asp-for="Description" class="form-label"></label>
              <textarea asp-for="Description" class="form-control" rows="3"></textarea>
              <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <div class="mb-3">
                  <label asp-for="QuestionType" class="form-label"></label>
                  <select asp-for="QuestionType" class="form-select" asp-items="ViewBag.QuestionTypes">
                    <option value="">-- اختر نوع الأسئلة --</option>
                  </select>
                  <span asp-validation-for="QuestionType" class="text-danger"></span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label asp-for="Difficulty" class="form-label"></label>
                  <select asp-for="Difficulty" class="form-select" asp-items="ViewBag.DifficultyLevels">
                    <option value="">-- اختر مستوى الصعوبة --</option>
                  </select>
                  <span asp-validation-for="Difficulty" class="text-danger"></span>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label asp-for="QuestionCount" class="form-label"></label>
              <input asp-for="QuestionCount" class="form-control" type="number" min="1" max="100" />
              <span asp-validation-for="QuestionCount" class="text-danger"></span>
              <small class="text-muted">عدد الأسئلة التي سيتم توليدها (من 1 إلى 100)</small>
            </div>

            <hr class="my-4" />
            <h6 class="mb-3">مصدر المحتوى</h6>

            <div class="mb-3">
              <label asp-for="ContentSourceType" class="form-label"></label>
              <select asp-for="ContentSourceType" class="form-select" asp-items="ViewBag.ContentSourceTypes"
                id="contentSourceType">
                <option value="">-- اختر نوع مصدر المحتوى --</option>
              </select>
              <span asp-validation-for="ContentSourceType" class="text-danger"></span>
            </div>

            <div id="textContentGroup" class="mb-3 d-none">
              <label asp-for="TextContent" class="form-label"></label>
              <textarea asp-for="TextContent" class="form-control" rows="6"></textarea>
              <span asp-validation-for="TextContent" class="text-danger"></span>
              <small class="text-muted">يمكنك إدخال النص المراد استخدامه لتوليد الأسئلة</small>
            </div>

            <div id="fileUploadGroup" class="mb-3 d-none">
              <label asp-for="File" class="form-label"></label>
              <input asp-for="File" class="form-control" type="file" />
              <span asp-validation-for="File" class="text-danger"></span>
              <small class="text-muted">يمكنك رفع ملف (PDF, صورة، ملف صوتي، فيديو) لاستخدامه في توليد الأسئلة</small>
            </div>

            <div class="mt-4">
              <button type="submit" class="btn btn-primary">
                <i class="bx bx-plus me-1"></i> إنشاء وتوليد الأسئلة
              </button>
              <a href="@Url.Action("Index", "QuestionSets")" class="btn btn-outline-secondary ms-2">
                <i class="bx bx-arrow-back me-1"></i> إلغاء
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
  @{
    await Html.RenderPartialAsync("_ValidationScriptsPartial");
  }
  <script>
    $(document).ready(function () {
      function toggleContentSources() {
        const sourceType = $('#contentSourceType').val();

        $('#textContentGroup, #fileUploadGroup').addClass('d-none');

        if (sourceType === 'text' || sourceType === 'topic' || sourceType === 'link' || sourceType === 'youtube') {
          $('#textContentGroup').removeClass('d-none');
        }
        else if (sourceType === 'document' || sourceType === 'image' || sourceType === 'audio' || sourceType === 'video') {
          $('#fileUploadGroup').removeClass('d-none');
        }
      }

      $('#contentSourceType').change(toggleContentSources);
      toggleContentSources(); // Run initially
    });
  </script>
}
